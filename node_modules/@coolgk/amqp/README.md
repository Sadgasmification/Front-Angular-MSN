
## @coolgk/amqp
a javascript / typescript module

`npm install @coolgk/amqp`

a simple RabbitMQ (amqp wrapper) class for publishing and consuming messages

Report bugs here: [https://github.com/coolgk/node-utils/issues](https://github.com/coolgk/node-utils/issues)
## Examples
```javascript
import { Amqp } from '@coolgk/amqp';
// OR
// const { Amqp } = require('@coolgk/amqp');

const amqp = new Amqp({
    url: 'amqp://localhost/vhost'
});

const message = {
    a: 1,
    b: 'b'
};

// CONSUMER MUST BE STARTED FIRST BEFORE PUSHLISHING ANY MESSAGE

// consumer.js
// consume message and return (send) a response back to publisher
amqp.consume(({rawMessage, message}) => {
    console.log('consumer received', message); // consumer received ignore response
                                               // consumer received { a: 1, b: 'b' }
    return {
        response: 'response message'
    }
});

// publisher.js
// publish a message, no response from consumer
amqp.publish('ignore response');

// publish a message and handle response from consumer
amqp.publish(message, ({rawResponseMessage, responseMessage}) => {
    console.log('response from consumer', responseMessage); // response from consumer { response: 'response message' }
});


// example to add:
// consume from (multiple) routes
// round robin consumers
// direct route + a catch all consumer

```
<a name="Amqp"></a>

## Amqp
**Kind**: global class  

* [Amqp](#Amqp)
    * [new Amqp(options)](#new_Amqp_new)
    * [.closeConnection()](#Amqp+closeConnection) ⇒ <code>void</code>
    * [.publish(message, [callback], [options])](#Amqp+publish) ⇒ <code>promise.&lt;Array.&lt;boolean&gt;&gt;</code>
    * [.consume(callback, [options])](#Amqp+consume) ⇒ <code>promise</code>
    * [.getChannel()](#Amqp+getChannel) ⇒ <code>promise</code>

<a name="new_Amqp_new"></a>

### new Amqp(options)

| Param | Type | Description |
| --- | --- | --- |
| options | <code>object</code> |  |
| options.url | <code>string</code> | connection string e.g. amqp://localhost |
| [options.sslPem] | <code>string</code> | pem file path |
| [options.sslCa] | <code>string</code> | sslCa file path |
| [options.sslPass] | <code>string</code> | password |

<a name="Amqp+closeConnection"></a>

### amqp.closeConnection() ⇒ <code>void</code>
**Kind**: instance method of [<code>Amqp</code>](#Amqp)  
<a name="Amqp+publish"></a>

### amqp.publish(message, [callback], [options]) ⇒ <code>promise.&lt;Array.&lt;boolean&gt;&gt;</code>
**Kind**: instance method of [<code>Amqp</code>](#Amqp)  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| message | <code>\*</code> |  | message any type that can be JSON.stringify'ed |
| [callback] | <code>function</code> |  | callback(message) for processing response from consumers |
| [options] | <code>object</code> |  |  |
| [options.routes] | <code>string</code> \| <code>Array.&lt;string&gt;</code> | <code>&quot;[&#x27;#&#x27;]&quot;</code> | route names |
| [options.exchangeName] | <code>string</code> | <code>&quot;&#x27;defaultExchange&#x27;&quot;</code> | exchange name |

<a name="Amqp+consume"></a>

### amqp.consume(callback, [options]) ⇒ <code>promise</code>
**Kind**: instance method of [<code>Amqp</code>](#Amqp)  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| callback | <code>function</code> |  | consumer(message) function should returns a promise |
| [options] | <code>object</code> |  |  |
| [options.routes] | <code>string</code> \| <code>Array.&lt;string&gt;</code> | <code>&quot;[&#x27;#&#x27;]&quot;</code> | exchange routes |
| [options.queueName] | <code>string</code> | <code>&quot;&#x27;&#x27;&quot;</code> | queue name for processing messages. consumers with the same queue name process messages in round robin style |
| [options.exchangeName] | <code>string</code> | <code>&quot;&#x27;defaultExchange&#x27;&quot;</code> | exchange name |
| [options.exchangeType] | <code>string</code> | <code>&quot;&#x27;topic&#x27;&quot;</code> | exchange type |
| [options.priority] | <code>number</code> | <code>0</code> | priority, larger numbers indicate higher priority |
| [options.prefetch] | <code>number</code> | <code>1</code> | 1 or 0, if to process request one at a time |

<a name="Amqp+getChannel"></a>

### amqp.getChannel() ⇒ <code>promise</code>
**Kind**: instance method of [<code>Amqp</code>](#Amqp)  
**Returns**: <code>promise</code> - - promise<channel>  
